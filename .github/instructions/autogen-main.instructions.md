---

applyTo: '**/*.py'
description: 提供针对 AutoGen 库的编码规范、最佳实践和指导，涵盖从代码结构到安全性和性能的各个方面。
---

- 最佳实践 1：采用模块化设计。利用 AutoGen 的多智能体框架创建具有特定角色的模块化 agent，提高代码复用性并简化复杂工作流的编排。例如：为数据获取、代码执行和响应格式化分别创建独立 agent。
- 最佳实践 2：定义可定制的工作流。利用 AutoGen 的能力，定义集成 LLM、人类输入和工具的可定制工作流，实现灵活的 agent 交互，提升 LLM 应用性能。实现一个工作流管理器以定义和控制 agent 之间的交互。
- 最佳实践 3：确保代码质量和一致性。实现 AutoGen 提供的自动代码格式化和 lint 功能，确保一致的编码风格和规范，减少代码生成中的人为错误，保持高代码质量。
- 最佳实践 4：使用 UV 进行依赖管理，实现更快更可靠的安装。
- 最佳实践 5：始终使用最新稳定版 Python（当前为 3.12），以获得更好的性能和安全性。
- 最佳实践 6：将配置与代码分离，使用环境变量和配置文件，便于修改而无需更改代码。

## 库信息：

- 名称：autogen
- 标签：ai, ml, llm, python, agent-framework, multi-agent

## AutoGen Examples 最佳实践综合指南

AutogenExamples 是一个基于 AutoGen 框架的多智能体示例项目，旨在展示如何利用 AutoGen 实现模块化 agent、工具和工作流的编排。项目结构清晰，涵盖了 agent 定制、工具集成、数据分析、工作流自动化等多种场景，便于开发者快速上手和扩展。

- 项目采用模块化设计，将 agent、工具和工作流分别组织为独立模块，提升代码复用性和可维护性。
- 每个 agent 具备明确职责，如数据获取、代码执行、响应格式化等，避免万能 agent 设计。
- 工作流通过集成 LLM、人类输入和工具，实现灵活的 agent 交互，支持自定义流程编排。
- 配置与代码分离，所有参数通过环境变量或配置文件管理，便于修改和扩展。
- 测试覆盖全面，包含单元测试、集成测试和端到端测试，保障各模块稳定性。
- 依赖管理采用 UV，确保安装快速且可靠，兼容最新稳定版 Python。


### 1. 代码组织与结构：

- **目录结构最佳实践：**

  **规则 1 遵循标准目录布局:**
  模型配置应放置在 `config/model_config.py` 中。
  示例代码应组织在 `examples/` 下，其子目录结构如下：
  examples中一共有三级目录:
  - 一级目录为 `examples` 包含了所有examples分类
  - 二级目录为 `advance`, `agent`, `mcp`, `tool`, `Workbench`。用于区分不同类型的示例。
  - 三级目录为具体的示例名称。在三级目录下，包含具体的示例代码文件。每个文件必须要main.py和README.md
  在项目根目录下的README.md文件中，提供了对每个示例的简要说明和使用方法。
  以下是目录结构的一些示例：
  `examples/advance/`: 包含高级功能相关的示例，例如 `custom_tool_call_agent`,
  `excel_anaysis`, `report_writer`, `report_writer_new`。
  `examples/agent/`: 包含与 Agent 功能相关的示例，例如 `custom_agent`, `hello_world`,
  `society_of_mind_agent`, `web_surfer`。
  `examples/mcp/`: 包含与 MCP 功能相关的示例，例如 `sse`。
  `examples/tool/`: 包含与工具功能相关的示例，例如 `agent_tool`,
  `insure_json_team_tool`。 \* `examples/Workbench/`: 包含与 Workbench 功能相关的示例，例如 `StaticWorkbench`。

- **文件命名规范：**
  - 使用有描述性的蛇形命名（如 `code_executor_agent.py`, `data_processing_tool.py`）。
  - 配置文件使用 `.yaml` 或 `.json` 后缀（如 `agent_config.yaml`）。
  - 测试文件命名为 `test_<module_name>.py`（如 `test_code_executor.py`）。
- **模块组织最佳实践：**
  - 将相关功能分组为模块（如 `agents`, `workflows`, `tools`）。
  - 使用 `__init__.py` 定义包和控制导入。
  - 实现清晰简明的模块级文档。
- **组件架构建议：**
  - 将 agent、工具和工作流分为独立组件。
  - 使用接口或抽象基类定义组件间的契约。
  - 实现中心注册表或依赖注入机制管理组件依赖。
- **代码拆分策略：**
  - 将大型 agent 拆分为更小、更易管理的类或函数。
  - 使用惰性加载或动态导入，仅在需要时加载组件。
  - 实现插件系统，允许外部组件扩展应用。

### 2. 常见模式与反模式：

- **设计模式：**
  - **工厂模式：** 根据配置或用户输入动态创建 agent 和工具。
  - **策略模式：** 根据当前上下文实现不同的 agent 行为或工具执行策略。
  - **观察者模式：** 允许 agent 订阅其他 agent 或工具的事件或通知。
- **常见任务推荐方法：**
  - **代码生成：** 利用 AutoGen 的代码生成能力自动创建样板代码或数据转换任务。例如：根据 schema 自动生成数据校验函数。
  - **数据分析：** 实现能分析数据、生成可视化和提取洞见的 agent。例如：分析网站流量数据并识别改进点。
  - **工作流编排：** 定义自动化复杂多步骤任务的工作流，涉及多个 agent 和工具。例如：自动生成、测试并部署代码变更的工作流。
- **反模式与代码异味：**
  - **万能 agent：** 避免创建承担过多任务的单一 agent，应将复杂任务拆分为更小的 agent。
  - **紧耦合：** 最小化 agent 与工具之间的依赖，使用接口或抽象基类解耦组件。
  - **代码重复：** 将通用功能提取为可复用的函数或类。
- **状态管理最佳实践：**
  - 使用中心化状态管理系统存储和管理应用状态。
  - 实现版本控制或快照机制跟踪状态变化。
  - 使用不可变数据结构防止意外状态修改。
- **错误处理模式：**
  - 实现健壮的错误处理机制捕获和处理异常。
  - 使用日志记录错误和调试问题。
  - 实现重试逻辑处理临时性错误。

### 3. 性能优化建议：

- **优化技术：**
  - **缓存：** 缓存频繁访问的数据以降低延迟、提升吞吐量。
  - **并行化：** 使用异步编程或多线程并行任务，提高性能。
  - **代码优化：** 分析和优化代码以减少执行时间。
- **内存管理：**
  - 使用生成器或迭代器分块处理大数据集。
  - 资源用完即释放。
  - 避免不必要的数据拷贝。
- **包体积优化（如适用）：** 对于 Python 库无需关注，但如开发 web 应用，使用 tree-shaking 移除未用代码，减小包体积。
- **惰性加载：** 仅在需要时加载模块和组件，减少启动时间和内存占用。

### 4. 安全最佳实践：

- **常见漏洞：**
  - **Prompt 注入：** 对用户输入进行清洗，防止恶意代码注入 agent prompt。
  - **未授权访问：** 实现访问控制，限制敏感数据和功能的访问。
  - **数据泄露：** 防止敏感数据在日志或错误信息中暴露。
- **输入校验：**
  - 校验所有用户输入，确保格式和范围符合预期。
  - 使用白名单限制允许的输入类型。
  - 清洗输入，移除潜在有害字符或代码。
- **认证与授权：**
  - 实现认证机制，验证用户或 agent 身份。
  - 使用授权政策控制资源和功能访问。
  - 使用基于角色的访问控制（RBAC）简化权限管理。
- **数据保护：**
  - 敏感数据静态和传输时加密。
  - 使用安全存储机制防止未授权访问。
  - 日志或错误信息中对敏感数据进行脱敏或匿名化。

### 5. 测试方法：

- **单元测试：**
  - 为各 agent、工具和工作流编写单元测试。
  - 使用 mock 或 stub 隔离组件测试。
  - 测试不同场景和边界情况。
- **集成测试：**
  - 编写集成测试验证组件间交互。
  - 测试与外部系统或 API 的集成。
  - 使用真实场景的数据进行测试。
- **端到端测试：**
  - 编写端到端测试验证整体功能。
  - 模拟用户交互，验证应用行为。
  - 使用自动化测试框架实现测试自动化。
- **测试组织：**
  - 按被测组件将测试组织到独立目录或文件。
  - 测试函数或类使用有描述性的命名。
  - 遵循一致的测试规范。
- **Mock 与 Stub：**
  - 使用 mock 替换外部依赖。
  - 使用 stub 替换复杂功能。
  - 使用 mock 框架简化 mock 过程。

### 6. 常见陷阱与注意事项：

- **常见错误：**
  - 未正确配置 LLM 参数（如 temperature、max tokens）。
  - 过于复杂的 prompt 导致 LLM 混淆。
  - 忽略错误信息和日志。
  - 未校验用户输入。
- **边界情况：**
  - 处理 LLM 意外响应。
  - 应对速率限制或 API 故障。
  - 处理大数据集或复杂工作流。
- **版本相关问题：**
  - 注意 AutoGen 更新中的破坏性变更。
  - 查阅发布说明，了解已知问题或解决方法。
- **兼容性问题：**
  - 确保 AutoGen 与项目中其他库或框架兼容。
  - 检查不同版本间的冲突。
- **调试策略：**
  - 使用日志跟踪执行流程和定位错误。
  - 使用调试器单步执行和检查变量。
  - 使用 print 输出中间结果。

### 7. 工具与环境：

- **推荐开发工具：**
  - VsCode
  - 依赖管理工具（如 pip、uv）。
- **构建配置：**
  - 使用构建系统自动化构建流程。
  - 配置构建系统运行 linter 和测试。
  - 使用虚拟环境隔离依赖。
- **CI/CD 集成：**
  - 使用 CI/CD 流水线自动化构建、测试和部署。
  - 将 CI/CD 流程与版本控制系统集成。
  - 使用自动化测试确保代码质量。
